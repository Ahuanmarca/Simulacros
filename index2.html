<!DOCTYPE html>
<html lang="es">
  <head>
    <!-- PWA / iOS support -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <meta charset="UTF-8" />
    <title>Quiz RENFE</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #fefefe;
        color: #333;
        padding: 2em;
      }
      .quiz-box, .menu-box, .summary {
        max-width: 800px;
        margin: auto;
        border: 1px solid #ccc;
        padding: 2em;
        border-radius: 8px;
        background: #fff;
      }
      .menu-box button {
        display: block;
        width: 100%;
        margin: 0.5em 0;
        padding: 1em;
        font-size: 1em;
      }
      .question {
        font-size: 1.1em;
        margin-bottom: 1em;
        white-space: pre-wrap;
      }
      .options button {
        display: block;
        width: 100%;
        padding: 0.5em;
        margin: 0.3em 0;
        font-size: 1em;
        text-align: left;
      }
      .options button.selected { background-color: #e0f7fa; border: 2px solid #00796b; }
      .options button.correct-answer { background-color: #d4edda; border: 2px solid green; }
      .options button.incorrect-answer { background-color: #f8d7da; border: 2px solid red; }
      .feedback { margin-top: 1em; font-style: italic; white-space: pre-wrap; }
      .feedback.correct { color: green; }
      .feedback.incorrect { color: red; font-style: normal; }
      #nextBtn { margin-top: 1em; padding: 0.5em 1em; font-size: 1em; }
    </style>

    <!-- Carga de cuestionarios como scripts -->
    <script src="cuestionarios/2025-01.js"></script>
    <script src="cuestionarios/2025-02.js"></script>
    <script src="cuestionarios/2025-03.js"></script>
    <script src="cuestionarios/2025-04.js"></script>
    <script src="cuestionarios/2025-05.js"></script>
  </head>
  <body>
    <div class="menu-box" id="menuBox">
      <h2>Elige un cuestionario</h2>
      <button onclick="iniciar('2025-01')">2025-01</button>
      <button onclick="iniciar('2025-02')">2025-02</button>
      <button onclick="iniciar('2025-03')">2025-03</button>
      <button onclick="iniciar('2025-04')">2025-04</button>
      <button onclick="iniciar('2025-05')">2025-05</button>
    </div>

    <div class="quiz-box" id="quizBox" style="display:none;"></div>
    <div class="summary" id="summary" style="display: none"></div>

    <script>
      const conjuntos = {
        "2025-01": preguntas_2025_01,
        "2025-02": preguntas_2025_02,
        "2025-03": preguntas_2025_03,
        "2025-04": preguntas_2025_04,
        "2025-05": preguntas_2025_05,
      };

      let preguntas = [], current = 0, answers = [], awaitingNext = false;

      function iniciar(clave) {
        preguntas = conjuntos[clave];
        current = 0;
        answers = [];
        document.getElementById("menuBox").style.display = "none";
        document.getElementById("quizBox").style.display = "block";
        document.getElementById("summary").style.display = "none";
        showQuestion(current);
      }

      function showQuestion(index) {
        const q = preguntas[index];
        const box = document.getElementById("quizBox");
        box.innerHTML = `
          <div class="question">${q.pregunta}</div>
          <div class="options">
            ${q.opciones.map((opt, i) => `<button onclick="submitAnswer(${i})" id="btn${i}">${opt}</button>`).join("")}
            <button onclick="submitAnswer(null)" id="btnPass">Pasar</button>
          </div>
          <div id="feedback"></div>
          <button id="nextBtn" style="display:none" onclick="nextQuestion()">Siguiente</button>
        `;
        awaitingNext = false;
      }

      function submitAnswer(selected) {
        if (awaitingNext) return;
        awaitingNext = true;
        const q = preguntas[current];
        const correctaLetra = q.correcta.trim().charAt(0).toLowerCase();
        const correctaIdx = q.opciones.findIndex(opt => opt.trim().charAt(0).toLowerCase() === correctaLetra);
        const isCorrect = selected === correctaIdx;

        document.querySelectorAll(".options button").forEach((btn, i) => {
          btn.disabled = true;
          btn.classList.remove("selected", "correct-answer", "incorrect-answer");
          if (i === correctaIdx) btn.classList.add("correct-answer");
        });

        if (selected !== null) {
          const selectedBtn = document.getElementById(`btn${selected}`);
          if (isCorrect) selectedBtn.classList.add("selected");
          else selectedBtn.classList.add("incorrect-answer");
        } else {
          document.getElementById("btnPass").classList.add("selected");
        }

        const feedbackBox = document.getElementById("feedback");
        const formattedComment = q.comentario.replace(/\n/g, "<br>");
        if (selected === null) {
          feedbackBox.innerHTML = `<div class="feedback">Pasada. ${formattedComment}</div>`;
          answers.push({ selected: null, correct: false });
        } else if (isCorrect) {
          feedbackBox.innerHTML = `<div class="feedback correct">¡Correcta!</div>`;
          answers.push({ selected, correct: true });
        } else {
          feedbackBox.innerHTML = `<div class="feedback"><span class="incorrect">Incorrecta.</span> ${formattedComment}</div>`;
          answers.push({ selected, correct: false });
        }

        document.getElementById("nextBtn").style.display = "inline-block";
      }

      function nextQuestion() {
        current++;
        if (current < preguntas.length) showQuestion(current);
        else showSummary();
      }

      function showSummary() {
        document.getElementById("quizBox").style.display = "none";
        const summary = document.getElementById("summary");
        const total = preguntas.length;
        const correct = answers.filter(a => a.correct).length;
        const passed = answers.filter(a => a.selected === null).length;
        const incorrect = total - correct - passed;

        summary.style.display = "block";
        summary.innerHTML = `
          <h2>Resumen</h2>
          <p>Correctas: ${correct}</p>
          <p>Incorrectas: ${incorrect}</p>
          <p>Pasadas: ${passed}</p>
          <button onclick="location.reload()">Volver al menú</button>
        `;
      }
    </script>
  </body>
</html>
